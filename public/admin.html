<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Order Status Admin</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 900px; margin: 40px auto; background: #f7f7f7; }
    h2 { color: #333; }
    table { width: 100%; border-collapse: collapse; margin-bottom: 24px; }
    th, td { padding: 8px 12px; border: 1px solid #ddd; text-align: left; }
    th { background: #eee; }
    .color-box { display: inline-block; width: 24px; height: 24px; border-radius: 4px; border: 1px solid #ccc; vertical-align: middle; }
    .actions button { margin-right: 6px; }
    .form-row { margin-bottom: 12px; }
    label { display: inline-block; width: 140px; }
    input[type="text"], textarea { padding: 6px; width: 320px; }
    textarea { height: 48px; resize: vertical; }
    select { padding: 6px; }
    .status-form { background: #fff; padding: 18px; border-radius: 8px; box-shadow: 0 2px 8px #eee; margin-bottom: 24px; }
    .btn { padding: 6px 16px; border: none; border-radius: 4px; background: #007bff; color: #fff; cursor: pointer; }
    .btn.delete { background: #dc3545; }
    .btn.edit { background: #ffc107; color: #333; }
    .checkbox-label { width: auto; display: inline; }
    input[type="checkbox"] { width: 18px; height: 18px; vertical-align: middle; }
  </style>
</head>
<body>
  <h2>Order Status Management</h2>
  <div class="status-form">
    <h4>Add / Edit Status</h4>
    <form id="statusForm">
      <div class="form-row">
        <label for="orderStatus">Order Status</label>
        <input type="text" id="orderStatus" required />
      </div>
      <div class="form-row">
        <label for="color">Color</label>
        <select id="color" required>
          <option value="red">Red</option>
          <option value="green">Green</option>
          <option value="yellow">Yellow</option>
          <option value="blue">Blue</option>
          <option value="light blue">Light Blue</option>
          <option value="light green">Light Green</option>
          <option value="light pink">Light Pink</option>
        </select>
        <span id="colorPreview" class="color-box" style="background: red;"></span>
      </div>
      <div class="form-row">
        <label for="description">Description</label>
        <input type="text" id="description" />
      </div>
      <div class="form-row">
        <label for="topContent">Top Content</label>
        <textarea id="topContent"></textarea>
      </div>
      <div class="form-row">
        <label for="bottomContent">Bottom Content</label>
        <textarea id="bottomContent"></textarea>
      </div>
      <div class="form-row">
        <label class="checkbox-label" for="emailCustomer">Email Customer?</label>
        <input type="checkbox" id="emailCustomer" />
      </div>
      <div class="form-row">
        <label for="emailStaff">Email Staff</label>
        <input type="text" id="emailStaff" placeholder="staff@email.com (optional)" />
      </div>
      <input type="hidden" id="statusId" />
      <button type="submit" class="btn" id="saveBtn">Add Status</button>
      <button type="button" class="btn" id="cancelEdit" style="display:none;">Cancel</button>
    </form>
  </div>
  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Status</th>
        <th>Color</th>
        <th>Description</th>
        <th>Email Customer?</th>
        <th>Email Staff</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="statusesTable"></tbody>
  </table>
  <script>
    const colorMap = {
      'red': '#dc3545',
      'green': '#28a745',
      'yellow': '#ffc107',
      'blue': '#007bff',
      'light blue': '#5bc0de',
      'light green': '#b2f2b2',
      'light pink': '#f8bbd0'
    };
    function fetchStatuses() {
      fetch('/api/statuses').then(r => r.json()).then(data => {
        const tbody = document.getElementById('statusesTable');
        tbody.innerHTML = '';
        data.forEach(s => {
          tbody.innerHTML += `<tr>
            <td>${s.id}</td>
            <td>${s.orderStatus}</td>
            <td><span class="color-box" style="background:${colorMap[s.color]||s.color}"></span> ${s.color}</td>
            <td>${s.description||''}</td>
            <td>${s.emailCustomer ? 'Yes' : 'No'}</td>
            <td>${s.emailStaff||''}</td>
            <td class="actions">
              <button class="btn edit" onclick="editStatus(${s.id})">Edit</button>
              <button class="btn delete" onclick="deleteStatus(${s.id})">Delete</button>
            </td>
          </tr>`;
        });
      });
    }
    function resetForm() {
      document.getElementById('statusForm').reset();
      document.getElementById('statusId').value = '';
      document.getElementById('saveBtn').textContent = 'Add Status';
      document.getElementById('cancelEdit').style.display = 'none';
      document.getElementById('colorPreview').style.background = colorMap['red'];
    }
    document.getElementById('color').addEventListener('change', function() {
      document.getElementById('colorPreview').style.background = colorMap[this.value] || this.value;
    });
    document.getElementById('statusForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const id = document.getElementById('statusId').value;
      const orderStatus = document.getElementById('orderStatus').value.trim();
      const color = document.getElementById('color').value;
      const description = document.getElementById('description').value.trim();
      const topContent = document.getElementById('topContent').value.trim();
      const bottomContent = document.getElementById('bottomContent').value.trim();
      const emailCustomer = document.getElementById('emailCustomer').checked;
      const emailStaff = document.getElementById('emailStaff').value.trim();
      if (!orderStatus) return alert('Order status required');
      const payload = { orderStatus, color, description, topContent, bottomContent, emailCustomer, emailStaff };
      if (id) {
        fetch(`/api/statuses/${id}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        }).then(fetchStatuses);
      } else {
        fetch('/api/statuses', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        }).then(fetchStatuses);
      }
      resetForm();
    });
    window.editStatus = function(id) {
      fetch('/api/statuses').then(r => r.json()).then(data => {
        const s = data.find(x => x.id === id);
        if (!s) return;
        document.getElementById('orderStatus').value = s.orderStatus;
        document.getElementById('color').value = s.color;
        document.getElementById('colorPreview').style.background = colorMap[s.color] || s.color;
        document.getElementById('description').value = s.description||'';
        document.getElementById('topContent').value = s.topContent||'';
        document.getElementById('bottomContent').value = s.bottomContent||'';
        document.getElementById('emailCustomer').checked = !!s.emailCustomer;
        document.getElementById('emailStaff').value = s.emailStaff||'';
        document.getElementById('statusId').value = s.id;
        document.getElementById('saveBtn').textContent = 'Update Status';
        document.getElementById('cancelEdit').style.display = '';
      });
    }
    window.deleteStatus = function(id) {
      if (!confirm('Delete this status?')) return;
      fetch(`/api/statuses/${id}`, { method: 'DELETE' }).then(fetchStatuses);
    }
    document.getElementById('cancelEdit').onclick = resetForm;
    fetchStatuses();
  </script>
</body>
</html> 